function worker_function(){var G=self.webkitPostMessage||self.postMessage,R={WORLDREPORT:0,COLLISIONREPORT:1,VEHICLEREPORT:2,CONSTRAINTREPORT:3},S,p,o,q={},d,l,c,y,F,B,K,U,H,n,h=0,v,x,D,C,z,Q,j={},L={},i={},t={},b={},f=0,k=0,w=0,m={},O={},M={},J={},P,N=14,g,s=5,E,a=9,e,u=6,I;var r=new ArrayBuffer(1);G(r,[r]);var T=(r.byteLength===0);d=function(V){if(m[V]!==undefined){return m[V]}return null};l=function(W,V){m[W]=V};c=function(ad){var X,ab;o.setIdentity();switch(ad.type){case"plane":X="plane_"+ad.normal.x+"_"+ad.normal.y+"_"+ad.normal.z;if((ab=d(X))===null){D.setX(ad.normal.x);D.setY(ad.normal.y);D.setZ(ad.normal.z);ab=new Ammo.btStaticPlaneShape(D,0);l(X,ab)}break;case"box":X="box_"+ad.width+"_"+ad.height+"_"+ad.depth;if((ab=d(X))===null){D.setX(ad.width/2);D.setY(ad.height/2);D.setZ(ad.depth/2);ab=new Ammo.btBoxShape(D);l(X,ab)}break;case"sphere":X="sphere_"+ad.radius;if((ab=d(X))===null){ab=new Ammo.btSphereShape(ad.radius);l(X,ab)}break;case"cylinder":X="cylinder_"+ad.width+"_"+ad.height+"_"+ad.depth;if((ab=d(X))===null){D.setX(ad.width/2);D.setY(ad.height/2);D.setZ(ad.depth/2);ab=new Ammo.btCylinderShape(D);l(X,ab)}break;case"capsule":X="capsule_"+ad.radius+"_"+ad.height;if((ab=d(X))===null){ab=new Ammo.btCapsuleShape(ad.radius,ad.height-2*ad.radius);l(X,ab)}break;case"cone":X="cone_"+ad.radius+"_"+ad.height;if((ab=d(X))===null){ab=new Ammo.btConeShape(ad.radius,ad.height);l(X,ab)}break;case"concave":var Y,Z,W=new Ammo.btTriangleMesh;if(!ad.triangles.length){return false}for(Y=0;Y<ad.triangles.length;Y++){Z=ad.triangles[Y];D.setX(Z[0].x);D.setY(Z[0].y);D.setZ(Z[0].z);C.setX(Z[1].x);C.setY(Z[1].y);C.setZ(Z[1].z);z.setX(Z[2].x);z.setY(Z[2].y);z.setZ(Z[2].z);W.addTriangle(D,C,z,true)}ab=new Ammo.btBvhTriangleMeshShape(W,true,true);M[ad.id]=ab;break;case"convex":var Y,ac,ab=new Ammo.btConvexHullShape;for(Y=0;Y<ad.points.length;Y++){ac=ad.points[Y];D.setX(ac.x);D.setY(ac.y);D.setZ(ac.z);ab.addPoint(D)}M[ad.id]=ab;break;case"heightfield":var V=Ammo.allocate(4*ad.xpts*ad.ypts,"float",Ammo.ALLOC_NORMAL);for(var aa=0;aa<ad.points.length;aa++){Ammo.setValue(V+aa,ad.points[aa],"float")}ab=new Ammo.btHeightfieldTerrainShape(ad.xpts,ad.ypts,V,1,-ad.absMaxHeight,ad.absMaxHeight,2,0,false);D.setX(ad.xsize/(ad.xpts-1));D.setY(ad.ysize/(ad.ypts-1));D.setZ(1);ab.setLocalScaling(D);M[ad.id]=ab;break;default:return;break}return ab};q.init=function(Y){importScripts(Y.ammo);o=new Ammo.btTransform;D=new Ammo.btVector3(0,0,0);C=new Ammo.btVector3(0,0,0);z=new Ammo.btVector3(0,0,0);Q=new Ammo.btQuaternion(0,0,0,0);P=Y.reportsize||50;if(T){g=new Float32Array(2+P*N);E=new Float32Array(2+P*s);e=new Float32Array(2+P*a);I=new Float32Array(2+P*u)}else{g=[];E=[];e=[];I=[]}g[0]=R.WORLDREPORT;E[0]=R.COLLISIONREPORT;e[0]=R.VEHICLEREPORT;I[0]=R.CONSTRAINTREPORT;var Z=new Ammo.btDefaultCollisionConfiguration,W=new Ammo.btCollisionDispatcher(Z),X=new Ammo.btSequentialImpulseConstraintSolver,V;if(!Y.broadphase){Y.broadphase={type:"dynamic"}}switch(Y.broadphase.type){case"sweepprune":D.setX(Y.broadphase.aabbmin.x);D.setY(Y.broadphase.aabbmin.y);D.setZ(Y.broadphase.aabbmin.z);C.setX(Y.broadphase.aabbmax.x);C.setY(Y.broadphase.aabbmax.y);C.setZ(Y.broadphase.aabbmax.z);V=new Ammo.btAxisSweep3(D,C);break;case"dynamic":default:V=new Ammo.btDbvtBroadphase;break}v=new Ammo.btDiscreteDynamicsWorld(W,V,X,Z);U=Y.fixedTimeStep;H=Y.rateLimit;G({cmd:"worldReady"})};q.registerMaterial=function(V){t[V.id]=V};q.unRegisterMaterial=function(V){delete t[V.id]};q.setFixedTimeStep=function(V){U=V};q.setGravity=function(V){D.setX(V.x);D.setY(V.y);D.setZ(V.z);v.setGravity(D)};q.addObject=function(ad){var aa,X,ac,Y,af,ab;ac=c(ad);if(!ac){return}if(ad.children){var W=new Ammo.btCompoundShape,Z;W.addChildShape(o,ac);for(aa=0;aa<ad.children.length;aa++){Z=ad.children[aa];var ae=new Ammo.btTransform;ae.setIdentity();D.setX(Z.position_offset.x);D.setY(Z.position_offset.y);D.setZ(Z.position_offset.z);ae.setOrigin(D);Q.setX(Z.rotation.x);Q.setY(Z.rotation.y);Q.setZ(Z.rotation.z);Q.setW(Z.rotation.w);ae.setRotation(Q);ac=c(ad.children[aa]);W.addChildShape(ae,ac);Ammo.destroy(ae)}ac=W;J[ad.id]=ac}D.setX(0);D.setY(0);D.setZ(0);ac.calculateLocalInertia(ad.mass,D);o.setIdentity();C.setX(ad.position.x);C.setY(ad.position.y);C.setZ(ad.position.z);o.setOrigin(C);Q.setX(ad.rotation.x);Q.setY(ad.rotation.y);Q.setZ(ad.rotation.z);Q.setW(ad.rotation.w);o.setRotation(Q);Y=new Ammo.btDefaultMotionState(o);af=new Ammo.btRigidBodyConstructionInfo(ad.mass,Y,ac,D);if(ad.materialId!==undefined){af.set_m_friction(t[ad.materialId].friction);af.set_m_restitution(t[ad.materialId].restitution)}ab=new Ammo.btRigidBody(af);Ammo.destroy(af);if(typeof ad.collision_flags!=="undefined"){ab.setCollisionFlags(ad.collision_flags)}v.addRigidBody(ab);ab.id=ad.id;j[ab.id]=ab;O[ab.id]=Y;var V=ab.a!=undefined?ab.a:ab.ptr;b[V]=ab.id;f++;G({cmd:"objectReady",params:ab.id})};q.addVehicle=function(V){var X=new Ammo.btVehicleTuning(),W;X.set_m_suspensionStiffness(V.suspension_stiffness);X.set_m_suspensionCompression(V.suspension_compression);X.set_m_suspensionDamping(V.suspension_damping);X.set_m_maxSuspensionTravelCm(V.max_suspension_travel);X.set_m_maxSuspensionForce(V.max_suspension_force);W=new Ammo.btRaycastVehicle(X,j[V.rigidBody],new Ammo.btDefaultVehicleRaycaster(v));W.tuning=X;j[V.rigidBody].setActivationState(4);W.setCoordinateSystem(0,1,2);v.addVehicle(W);L[V.id]=W};q.removeVehicle=function(V){delete L[V.id]};q.addWheel=function(V){if(L[V.id]!==undefined){var W=L[V.id].tuning;if(V.tuning!==undefined){W=new Ammo.btVehicleTuning();W.set_m_suspensionStiffness(V.tuning.suspension_stiffness);W.set_m_suspensionCompression(V.tuning.suspension_compression);W.set_m_suspensionDamping(V.tuning.suspension_damping);W.set_m_maxSuspensionTravelCm(V.tuning.max_suspension_travel);W.set_m_maxSuspensionForce(V.tuning.max_suspension_force)}D.setX(V.connection_point.x);D.setY(V.connection_point.y);D.setZ(V.connection_point.z);C.setX(V.wheel_direction.x);C.setY(V.wheel_direction.y);C.setZ(V.wheel_direction.z);z.setX(V.wheel_axle.x);z.setY(V.wheel_axle.y);z.setZ(V.wheel_axle.z);L[V.id].addWheel(D,C,z,V.suspension_rest_length,V.wheel_radius,W,V.is_front_wheel)}k++;if(T){e=new Float32Array(1+k*a);e[0]=R.VEHICLEREPORT}else{e=[R.VEHICLEREPORT]}};q.setSteering=function(V){if(L[V.id]!==undefined){L[V.id].setSteeringValue(V.steering,V.wheel)}};q.setBrake=function(V){if(L[V.id]!==undefined){L[V.id].setBrake(V.brake,V.wheel)}};q.applyEngineForce=function(V){if(L[V.id]!==undefined){L[V.id].applyEngineForce(V.force,V.wheel)}};q.removeObject=function(V){v.removeRigidBody(j[V.id]);Ammo.destroy(j[V.id]);Ammo.destroy(O[V.id]);if(J[V.id]){Ammo.destroy(J[V.id])}if(M[V.id]){Ammo.destroy(M[V.id])}var W=j[V.id].a!=undefined?j[V.id].a:j[V.id].ptr;delete b[W];delete j[V.id];delete O[V.id];if(J[V.id]){delete J[V.id]}if(M[V.id]){delete M[V.id]}f--};q.updateTransform=function(V){S=j[V.id];S.getMotionState().getWorldTransform(o);if(V.pos){D.setX(V.pos.x);D.setY(V.pos.y);D.setZ(V.pos.z);o.setOrigin(D)}if(V.quat){Q.setX(V.quat.x);Q.setY(V.quat.y);Q.setZ(V.quat.z);Q.setW(V.quat.w);o.setRotation(Q)}S.setWorldTransform(o);S.activate()};q.updateMass=function(V){S=j[V.id];v.removeRigidBody(S);D.setX(0);D.setY(0);D.setZ(0);S.setMassProps(V.mass,D);v.addRigidBody(S);S.activate()};q.applyCentralImpulse=function(V){D.setX(V.x);D.setY(V.y);D.setZ(V.z);j[V.id].applyCentralImpulse(D);j[V.id].activate()};q.applyImpulse=function(V){D.setX(V.impulse_x);D.setY(V.impulse_y);D.setZ(V.impulse_z);C.setX(V.x);C.setY(V.y);C.setZ(V.z);j[V.id].applyImpulse(D,C);j[V.id].activate()};q.applyTorque=function(V){D.setX(V.torque_x);D.setY(V.torque_y);D.setZ(V.torque_z);j[V.id].applyTorque(D);j[V.id].activate()};q.applyCentralForce=function(V){D.setX(V.x);D.setY(V.y);D.setZ(V.z);j[V.id].applyCentralForce(D);j[V.id].activate()};q.applyForce=function(V){D.setX(V.force_x);D.setY(V.force_y);D.setZ(V.force_z);C.setX(V.x);C.setY(V.y);C.setZ(V.z);j[V.id].applyForce(D,C);j[V.id].activate()};q.onSimulationResume=function(V){n=Date.now()};q.setAngularVelocity=function(V){D.setX(V.x);D.setY(V.y);D.setZ(V.z);j[V.id].setAngularVelocity(D);j[V.id].activate()};q.setLinearVelocity=function(V){D.setX(V.x);D.setY(V.y);D.setZ(V.z);j[V.id].setLinearVelocity(D);j[V.id].activate()};q.setAngularFactor=function(V){D.setX(V.x);D.setY(V.y);D.setZ(V.z);j[V.id].setAngularFactor(D)};q.setLinearFactor=function(V){D.setX(V.x);D.setY(V.y);D.setZ(V.z);j[V.id].setLinearFactor(D)};q.setDamping=function(V){j[V.id].setDamping(V.linear,V.angular)};q.setCcdMotionThreshold=function(V){j[V.id].setCcdMotionThreshold(V.threshold)};q.setCcdSweptSphereRadius=function(V){j[V.id].setCcdSweptSphereRadius(V.radius)};q.addConstraint=function(Y){var Z;switch(Y.type){case"point":if(Y.objectb===undefined){D.setX(Y.positiona.x);D.setY(Y.positiona.y);D.setZ(Y.positiona.z);Z=new Ammo.btPoint2PointConstraint(j[Y.objecta],D)}else{D.setX(Y.positiona.x);D.setY(Y.positiona.y);D.setZ(Y.positiona.z);C.setX(Y.positionb.x);C.setY(Y.positionb.y);C.setZ(Y.positionb.z);Z=new Ammo.btPoint2PointConstraint(j[Y.objecta],j[Y.objectb],D,C)}break;case"hinge":if(Y.objectb===undefined){D.setX(Y.positiona.x);D.setY(Y.positiona.y);D.setZ(Y.positiona.z);C.setX(Y.axis.x);C.setY(Y.axis.y);C.setZ(Y.axis.z);Z=new Ammo.btHingeConstraint(j[Y.objecta],D,C)}else{D.setX(Y.positiona.x);D.setY(Y.positiona.y);D.setZ(Y.positiona.z);C.setX(Y.positionb.x);C.setY(Y.positionb.y);C.setZ(Y.positionb.z);z.setX(Y.axis.x);z.setY(Y.axis.y);z.setZ(Y.axis.z);Z=new Ammo.btHingeConstraint(j[Y.objecta],j[Y.objectb],D,C,z,z)}break;case"slider":var W,V,X;W=new Ammo.btTransform();D.setX(Y.positiona.x);D.setY(Y.positiona.y);D.setZ(Y.positiona.z);W.setOrigin(D);var X=W.getRotation();X.setEuler(Y.axis.x,Y.axis.y,Y.axis.z);W.setRotation(X);if(Y.objectb){V=new Ammo.btTransform();C.setX(Y.positionb.x);C.setY(Y.positionb.y);C.setZ(Y.positionb.z);V.setOrigin(C);X=V.getRotation();X.setEuler(Y.axis.x,Y.axis.y,Y.axis.z);V.setRotation(X);Z=new Ammo.btSliderConstraint(j[Y.objecta],j[Y.objectb],W,V,true)}else{Z=new Ammo.btSliderConstraint(j[Y.objecta],W,true)}Ammo.destroy(W);if(V!=undefined){Ammo.destroy(V)}break;case"conetwist":var W,V;W=new Ammo.btTransform();W.setIdentity();V=new Ammo.btTransform();V.setIdentity();D.setX(Y.positiona.x);D.setY(Y.positiona.y);D.setZ(Y.positiona.z);C.setX(Y.positionb.x);C.setY(Y.positionb.y);C.setZ(Y.positionb.z);W.setOrigin(D);V.setOrigin(C);var X=W.getRotation();X.setEulerZYX(-Y.axisa.z,-Y.axisa.y,-Y.axisa.x);W.setRotation(X);X=V.getRotation();X.setEulerZYX(-Y.axisb.z,-Y.axisb.y,-Y.axisb.x);V.setRotation(X);Z=new Ammo.btConeTwistConstraint(j[Y.objecta],j[Y.objectb],W,V);Z.setLimit(Math.PI,0,Math.PI);Ammo.destroy(W);Ammo.destroy(V);break;case"dof":var W,V,X;W=new Ammo.btTransform();W.setIdentity();D.setX(Y.positiona.x);D.setY(Y.positiona.y);D.setZ(Y.positiona.z);W.setOrigin(D);X=W.getRotation();X.setEulerZYX(-Y.axisa.z,-Y.axisa.y,-Y.axisa.x);W.setRotation(X);if(Y.objectb){V=new Ammo.btTransform();V.setIdentity();C.setX(Y.positionb.x);C.setY(Y.positionb.y);C.setZ(Y.positionb.z);V.setOrigin(C);X=V.getRotation();X.setEulerZYX(-Y.axisb.z,-Y.axisb.y,-Y.axisb.x);V.setRotation(X);Z=new Ammo.btGeneric6DofConstraint(j[Y.objecta],j[Y.objectb],W,V)}else{Z=new Ammo.btGeneric6DofConstraint(j[Y.objecta],W)}Ammo.destroy(W);if(V!=undefined){Ammo.destroy(V)}break;default:return}v.addConstraint(Z);Z.enableFeedback();i[Y.id]=Z;w++;if(T){I=new Float32Array(1+w*u);I[0]=R.CONSTRAINTREPORT}else{I=[R.CONSTRAINTREPORT]}};q.removeConstraint=function(V){var W=i[V.id];if(W!==undefined){v.removeConstraint(W);delete i[V.id];w--}};q.constraint_setBreakingImpulseThreshold=function(V){var W=i[V.id];if(W!==undefind){W.setBreakingImpulseThreshold(V.threshold)}};q.simulate=function A(V){if(v){V=V||{};if(!V.timeStep){if(n){V.timeStep=0;while(V.timeStep+h<=U){V.timeStep=(Date.now()-n)/1000}}else{V.timeStep=U}}else{if(V.timeStep<U){V.timeStep=U}}V.maxSubSteps=V.maxSubSteps||Math.ceil(V.timeStep/U);h=Date.now();v.stepSimulation(V.timeStep,V.maxSubSteps,U);F();B();K();y();h=(Date.now()-h)/1000;n=Date.now()}};q.hinge_setLimits=function(V){i[V.constraint].setLimit(V.low,V.high,0,V.bias_factor,V.relaxation_factor)};q.hinge_enableAngularMotor=function(W){var V=i[W.constraint];V.enableAngularMotor(true,W.velocity,W.acceleration);V.getRigidBodyA().activate();if(V.getRigidBodyB()){V.getRigidBodyB().activate()}};q.hinge_disableMotor=function(V){i[V.constraint].enableMotor(false);if(constraint.getRigidBodyB()){constraint.getRigidBodyB().activate()}};q.slider_setLimits=function(W){var V=i[W.constraint];V.setLowerLinLimit(W.lin_lower||0);V.setUpperLinLimit(W.lin_upper||0);V.setLowerAngLimit(W.ang_lower||0);V.setUpperAngLimit(W.ang_upper||0)};q.slider_setRestitution=function(W){var V=i[W.constraint];V.setSoftnessLimLin(W.linear||0);V.setSoftnessLimAng(W.angular||0)};q.slider_enableLinearMotor=function(W){var V=i[W.constraint];V.setTargetLinMotorVelocity(W.velocity);V.setMaxLinMotorForce(W.acceleration);V.setPoweredLinMotor(true);V.getRigidBodyA().activate();if(V.getRigidBodyB()){V.getRigidBodyB().activate()}};q.slider_disableLinearMotor=function(W){var V=i[W.constraint];V.setPoweredLinMotor(false);if(V.getRigidBodyB()){V.getRigidBodyB().activate()}};q.slider_enableAngularMotor=function(W){var V=i[W.constraint];V.setTargetAngMotorVelocity(W.velocity);V.setMaxAngMotorForce(W.acceleration);V.setPoweredAngMotor(true);V.getRigidBodyA().activate();if(V.getRigidBodyB()){V.getRigidBodyB().activate()}};q.slider_disableAngularMotor=function(W){var V=i[W.constraint];V.setPoweredAngMotor(false);V.getRigidBodyA().activate();if(V.getRigidBodyB()){V.getRigidBodyB().activate()}};q.conetwist_setLimit=function(V){i[V.constraint].setLimit(V.z,V.y,V.x)};q.conetwist_enableMotor=function(W){var V=i[W.constraint];V.enableMotor(true);V.getRigidBodyA().activate();V.getRigidBodyB().activate()};q.conetwist_setMaxMotorImpulse=function(W){var V=i[W.constraint];V.setMaxMotorImpulse(W.max_impulse);V.getRigidBodyA().activate();V.getRigidBodyB().activate()};q.conetwist_setMotorTarget=function(W){var V=i[W.constraint];Q.setX(W.x);Q.setY(W.y);Q.setZ(W.z);Q.setW(W.w);V.setMotorTarget(Q);V.getRigidBodyA().activate();V.getRigidBodyB().activate()};q.conetwist_disableMotor=function(W){var V=i[W.constraint];V.enableMotor(false);V.getRigidBodyA().activate();V.getRigidBodyB().activate()};q.dof_setLinearLowerLimit=function(W){var V=i[W.constraint];D.setX(W.x);D.setY(W.y);D.setZ(W.z);V.setLinearLowerLimit(D);V.getRigidBodyA().activate();if(V.getRigidBodyB()){V.getRigidBodyB().activate()}};q.dof_setLinearUpperLimit=function(W){var V=i[W.constraint];D.setX(W.x);D.setY(W.y);D.setZ(W.z);V.setLinearUpperLimit(D);V.getRigidBodyA().activate();if(V.getRigidBodyB()){V.getRigidBodyB().activate()}};q.dof_setAngularLowerLimit=function(W){var V=i[W.constraint];D.setX(W.x);D.setY(W.y);D.setZ(W.z);V.setAngularLowerLimit(D);V.getRigidBodyA().activate();if(V.getRigidBodyB()){V.getRigidBodyB().activate()}};q.dof_setAngularUpperLimit=function(W){var V=i[W.constraint];D.setX(W.x);D.setY(W.y);D.setZ(W.z);V.setAngularUpperLimit(D);V.getRigidBodyA().activate();if(V.getRigidBodyB()){V.getRigidBodyB().activate()}};q.dof_enableAngularMotor=function(X){var W=i[X.constraint];var V=W.getRotationalLimitMotor(X.which);V.set_m_enableMotor(true);W.getRigidBodyA().activate();if(W.getRigidBodyB()){W.getRigidBodyB().activate()}};q.dof_configureAngularMotor=function(X){var W=i[X.constraint];var V=W.getRotationalLimitMotor(X.which);V.set_m_loLimit(X.low_angle);V.set_m_hiLimit(X.high_angle);V.set_m_targetVelocity(X.velocity);V.set_m_maxMotorForce(X.max_force);W.getRigidBodyA().activate();if(W.getRigidBodyB()){W.getRigidBodyB().activate()}};q.dof_disableAngularMotor=function(X){var W=i[X.constraint];var V=W.getRotationalLimitMotor(X.which);V.set_m_enableMotor(false);W.getRigidBodyA().activate();if(W.getRigidBodyB()){W.getRigidBodyB().activate()}};y=function(){var Y,X,W,V,aa,ab=0,Z=0;if(T){if(g.length<2+f*N){g=new Float32Array(2+(Math.ceil(f/P)*P)*N);g[0]=R.WORLDREPORT}}g[1]=f;for(Y in j){if(j.hasOwnProperty(Y)){X=j[Y];W=X.getCenterOfMassTransform();V=W.getOrigin();aa=W.getRotation();ab=2+(Z++)*N;g[ab]=X.id;g[ab+1]=V.x();g[ab+2]=V.y();g[ab+3]=V.z();g[ab+4]=aa.x();g[ab+5]=aa.y();g[ab+6]=aa.z();g[ab+7]=aa.w();p=X.getLinearVelocity();g[ab+8]=p.x();g[ab+9]=p.y();g[ab+10]=p.z();p=X.getAngularVelocity();g[ab+11]=p.x();g[ab+12]=p.y();g[ab+13]=p.z()}}if(T){G(g.buffer,[g.buffer])}else{G(g)}};B=function(){var aa,X,W=v.getDispatcher(),ab=W.getNumManifolds(),Z,ac,Y,ad,V=false;if(T){if(E.length<2+ab*s){E=new Float32Array(2+(Math.ceil(f/P)*P)*s);E[0]=R.COLLISIONREPORT}}E[1]=0;for(aa=0;aa<ab;aa++){Z=W.getManifoldByIndexInternal(aa);ac=Z.getNumContacts();if(ac===0){continue}for(Y=0;Y<ac;Y++){ad=Z.getContactPoint(Y);X=2+(E[1]++)*s;E[X]=b[Z.getBody0()];E[X+1]=b[Z.getBody1()];p=ad.get_m_normalWorldOnB();E[X+2]=p.x();E[X+3]=p.y();E[X+4]=p.z();break;G(b)}}if(T){G(E.buffer,[E.buffer])}else{G(E)}};F=function(){var Y,ac,X,V,aa,ab=0,Z=0,W=0;if(T){if(e.length<2+k*a){e=new Float32Array(2+(Math.ceil(k/P)*P)*a);e[0]=R.VEHICLEREPORT}}for(Y in L){if(L.hasOwnProperty(Y)){ac=L[Y];for(W=0;W<ac.getNumWheels();W++){X=ac.getWheelInfo(W).get_m_worldTransform();V=X.getOrigin();aa=X.getRotation();ab=1+(Z++)*a;e[ab]=Y;e[ab+1]=W;e[ab+2]=V.x();e[ab+3]=V.y();e[ab+4]=V.z();e[ab+5]=aa.x();e[ab+6]=aa.y();e[ab+7]=aa.z();e[ab+8]=aa.w()}}}if(W!==0){if(T){G(e.buffer,[e.buffer])}else{G(e)}}};K=function(){var Y,aa,X,W,V,ab=0,Z=0;if(T){if(I.length<2+w*u){I=new Float32Array(2+(Math.ceil(w/P)*P)*u);I[0]=R.CONSTRAINTREPORT}}for(Y in i){if(i.hasOwnProperty(Y)){aa=i[Y];X=aa.getRigidBodyA();W=aa.getFrameOffsetA();V=W.getOrigin();ab=1+(Z++)*u;I[ab]=Y;I[ab+1]=X.id;I[ab+2]=V.getX();I[ab+3]=V.getY();I[ab+4]=V.getZ();I[ab+5]=aa.getAppliedImpulse()}}if(Z!==0){if(T){G(I.buffer,[I.buffer])}else{G(I)}}};self.onmessage=function(V){if(V.data instanceof Float32Array){switch(V.data[0]){case R.WORLDREPORT:g=new Float32Array(V.data);break;case R.COLLISIONREPORT:E=new Float32Array(V.data);break;case R.VEHICLEREPORT:e=new Float32Array(V.data);break;case R.CONSTRAINTREPORT:I=new Float32Array(V.data);break}return}if(V.data.cmd&&q[V.data.cmd]){q[V.data.cmd](V.data.params)}}}if(window!=self){worker_function()};
